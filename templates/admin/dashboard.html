{% extends "admin/base.html" %}

{% block title %}Dashboard - Admin Panel{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="row">
    <!-- Statistics Cards -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
            <div class="stat-icon primary">
                <i class="fas fa-envelope"></i>
            </div>
            <h3 class="mb-1">{{ total_contacts }}</h3>
            <p class="text-muted mb-0">Total Contact Messages</p>
            <small class="text-success">
                <i class="fas fa-arrow-up me-1"></i>{{ unread_contacts }} unread
            </small>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
            <div class="stat-icon success">
                <i class="fas fa-robot"></i>
            </div>
            <h3 class="mb-1">{{ total_chatbot_conversations }}</h3>
            <p class="text-muted mb-0">Chatbot Conversations</p>
            <small class="text-info">
                <i class="fas fa-circle me-1"></i>{{ active_chatbot_conversations }} active
            </small>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
            <div class="stat-icon warning">
                <i class="fas fa-eye"></i>
            </div>
            <h3 class="mb-1">{{ total_page_views }}</h3>
            <p class="text-muted mb-0">Total Page Views</p>
            <small class="text-warning">
                <i class="fas fa-chart-line me-1"></i>Analytics data
            </small>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stat-card">
            <div class="stat-icon info">
                <i class="fas fa-users"></i>
            </div>
            <h3 class="mb-1">{{ total_sessions }}</h3>
            <p class="text-muted mb-0">Visitor Sessions</p>
            <small class="text-info">
                <i class="fas fa-globe me-1"></i>Unique visitors
            </small>
        </div>
    </div>
</div>

<div class="row">
    <!-- Recent Contact Messages -->
    <div class="col-lg-6 mb-4">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Recent Contact Messages</h5>
                <a href="{{ url_for('admin.messages') }}" class="btn btn-sm btn-outline-primary">
                    View All <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
            
            {% if recent_contacts %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Subject</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for message in recent_contacts %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px; font-size: 12px;">
                                            {{ message.name[0].upper() if message.name else 'U' }}
                                        </div>
                                        {{ message.name }}
                                    </div>
                                </td>
                                <td>
                                    <div class="text-truncate" style="max-width: 150px;" title="{{ message.subject }}">
                                        {{ message.subject }}
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'success' if message.status == 'responded' else 'warning' if message.status == 'pending' else 'info' if message.status == 'new' else 'secondary' }}">
                                        {{ message.status.title() }}
                                    </span>
                                </td>
                                <td>
                                    <div class="table-actions">
                                        <a href="{{ url_for('admin.view_message', message_id=message.id) }}" class="btn-action btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No contact messages yet</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Recent Chatbot Conversations -->
    <div class="col-lg-6 mb-4">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Recent Chatbot Conversations</h5>
                <a href="{{ url_for('admin.chatbot') }}" class="btn btn-sm btn-outline-success">
                    View All <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
            
            {% if recent_chatbot %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Service</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for conversation in recent_chatbot %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px; font-size: 12px;">
                                            {{ conversation.user_name[0].upper() if conversation.user_name else 'U' }}
                                        </div>
                                        <div>
                                            <div>{{ conversation.user_name or 'Anonymous' }}</div>
                                            <small class="text-muted">{{ conversation.user_email or 'No email' }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-truncate" style="max-width: 120px;" title="{{ conversation.service_requested }}">
                                        {{ conversation.service_requested or 'General' }}
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'success' if conversation.status == 'completed' else 'warning' if conversation.status == 'follow_up' else 'info' }}">
                                        {{ conversation.status.replace('_', ' ').title() }}
                                    </span>
                                </td>
                                <td>
                                    <div class="table-actions">
                                        <a href="{{ url_for('admin.view_conversation', conversation_id=conversation.id) }}" class="btn-action btn btn-sm btn-outline-success">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-robot fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No chatbot conversations yet</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row">
    <div class="col-12">
        <div class="stat-card">
            <h5 class="mb-3">Quick Actions</h5>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <a href="{{ url_for('admin.messages') }}" class="btn btn-outline-primary w-100">
                        <i class="fas fa-envelope me-2"></i>Manage Messages
                    </a>
                </div>
                <div class="col-md-3 mb-3">
                    <a href="{{ url_for('admin.chatbot') }}" class="btn btn-outline-success w-100">
                        <i class="fas fa-robot me-2"></i>View Chatbot
                    </a>
                </div>
                <div class="col-md-3 mb-3">
                    <a href="{{ url_for('admin.analytics') }}" class="btn btn-outline-warning w-100">
                        <i class="fas fa-chart-line me-2"></i>View Analytics
                    </a>
                </div>
                <div class="col-md-3 mb-3">
                    <a href="{{ url_for('admin.profile') }}" class="btn btn-outline-info w-100">
                        <i class="fas fa-user-cog me-2"></i>Edit Profile
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
